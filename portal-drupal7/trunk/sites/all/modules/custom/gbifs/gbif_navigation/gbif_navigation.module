<?php

/**
 * @file
 * gbif_navigation.module
 */

/**
 * Implements hook_block_info_alter().
 */
function gbif_navigation_block_info_alter(&$block, $theme, $code_blocks) {
  switch ($theme) {
    case 'bvng':
     $block['system']['navigation']['weight'] = 0;
     $block['system']['navigation']['status'] = 0;
     $block['system']['navigation']['region'] = -1;
     
     // Turn off the existing level2-menu.
     $block['menu_block']['1']['weight'] = 0;
     $block['menu_block']['1']['status'] = 0;
     $block['menu_block']['1']['region'] = -1;
     
     $block['menu_block']['gbif_navigation_nav']['weight'] = 0;
     $block['menu_block']['gbif_navigation_nav']['status'] = 1;
     $block['menu_block']['gbif_navigation_nav']['region'] = 'navigation';
     $block['menu_block']['gbif_navigation_nav']['title'] = '<none>';

     $block['menu_block']['gbif_navigation_menu_tabs']['weight'] = 0;
     $block['menu_block']['gbif_navigation_menu_tabs']['status'] = 1;
     $block['menu_block']['gbif_navigation_menu_tabs']['region'] = 'menu';
     $block['menu_block']['gbif_navigation_menu_tabs']['title'] = '<none>';
     
     break;
  }
}

/**
 * Implements hook_menu_block_blocks().
 */
function gbif_navigation_menu_block_blocks() {
  // The array key is the block delta used by menu block.
  return array(
    'gbif_navigation_nav' => array(
      'menu_name'   => 'gbif-menu',
      'parent_mlid' => 0,
      'title_link'  => 0,
      'admin_title' => 'Navigation menu',
      'level'       => 1,
      'follow'      => 0,
      'depth'       => 2,
      'expanded'    => 1,
      'sort'        => 0,
    ),
    'gbif_navigation_menu_tabs' => array(
      'menu_name'   => 'gbif-menu',
      'parent_mlid' => 0,
      'title_link'  => 0,
      'admin_title' => 'Menu tabs',
      'level'       => 3,
      'follow'      => 0,
      'depth'       => 1,
      'expanded'    => 0,
      'sort'        => 0,
    ),
  );
}

/**
 * Implements hook_node_view().
 *
 * We use this hook to set the active menu item so visitors would have
 * a clearer idea about where they are.
 *
 * We want to keep the meaningful path alias so in the code we use path
 * alias as proxy to the internal/system path. It's also easier for developers
 * to communicate and maintain.
 *
 * @see http://www.dibe.gr/blog/set-path-determining-active-trail-drupal-7-menu
 */
function gbif_navigation_node_view($node, $view_mode, $langcode) {
  switch ($node->type) {
    case 'newsarticle':
      $system_path = drupal_get_normal_path('newsroom/news'); // taxonomy/term/566
      menu_set_active_item($system_path);
      break;
    case 'usesofdata':
      $system_path = drupal_get_normal_path('newsroom/uses'); // taxonomy/term/567
      menu_set_active_item($system_path);
      break;  
  }
}

/**
 * Implements hook_form_alter().
 *
 * Provides a checkbox to indicate that the menu item points to a portal URL that
 * is not served by Drupal itself.
 */
function gbif_navigation_form_menu_edit_item_alter(&$form, &$form_state, $form_id) {
  $form['link_title']['#weight'] = -5;
  $form['link_path']['#weight'] = -3;
  $form['description']['#weight'] = -1;
  $form['non_drupal_portal_url'] = array(
    '#type' => 'checkbox',
    '#title' => t('Non-Drupal portal URL'),
    '#description' => t('Check if this menu item points to a non-Drupal portal URL. Once checked, the base URL will be determined by the mode of this installation - live, uat or dev.'),
    '#weight' => 0,
  );
}